{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Parameters": {
    "InstanceType": {
      "Description": "Server instance type",
      "Type": "String",
      "Default": "t2.micro",
      "AllowedValues": [
        "t2.micro",
        "t2.small"
      ],
      "ConstraintDescription": "Must be a valid EC2 type."
    },
    "YourIP": {
      "Description": "Your IP address in CIDR format + '/32' or '/64'",
      "Type": "String"
    },
    "KeyPair": {
      "Description": "The EC2 Key Pair",
      "Type": "AWS::EC2::KeyPair::KeyName"
    }
  },
  "Resources": {
    "EngineeringVpc": {
      "Type": "AWS::EC2::VPC",
      "Properties": {
        "CidrBlock": "10.0.0.0/18"
      }
    },
    "PublicSubnet1": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {"Ref": "EngineeringVpc"},
        "CidrBlock": "10.0.0.0/24"
      }
    },
    "PublicSubnet2": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": {"Ref": "EngineeringVpc"},
        "CidrBlock": "10.0.1.0/24"
      }
    },




    "WebInstanceRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": ["sts:AssumeRole"],
              "Effect": "Allow",
              "Principal": {"Service": ["ec2.amazonaws.com"]}                  
            }              
          ]          
        },          
        "ManagedPolicyArns": ["arn:aws:iam::aws:policy/AmazonS3FullAccess"]
      }    
    },
    "WebInstanceProfile": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Roles": [{"Ref": "WebInstanceRole"}]
      }    
    },

    "web1": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "InstanceType": {"Ref": "InstanceType"},
        "KeyName": {"Ref": "KeyPair"},
        "ImageId": "ami-01cc34ab2709337aa",
        "SubnetId": {"Ref": "PublicSubnet1"},
        "IamInstanceProfile": {"Ref": "WebInstanceProfile"},
        "UserData": "#!/bin/bash\nyum update -y\nyum install -y git httpd php\nservice httpd start\nchkconfig httpd on\naws s3 cp s3://seis665-public/index.php /var/www/html/"
      }
    },
    "web2": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "InstanceType": {"Ref": "InstanceType"},
        "KeyName": {"Ref": "KeyPair"},
        "ImageId": "ami-01cc34ab2709337aa",
        "SubnetId": {"Ref": "PublicSubnet2"},
        "IamInstanceProfile": {"Ref": "WebInstanceProfile"},
        "UserData": "#!/bin/bash\nyum update -y\nyum install -y git httpd php\nservice httpd start\nchkconfig httpd on\naws s3 cp s3://seis665-public/index.php /var/www/html/"
      }
    },
    "WebserversSG": {

    },
    "EngineeringLB": {

    },
    "EngineeringWebservers": {
      
    }

  }
  
}